{"is_source_file": true, "format": "TypeScript (Angular component)", "description": "This is an Angular component (FigmaScreenComponent) responsible for rendering a Figma design embedded HTML within an Angular application. It fetches an HTML file, sanitizes and injects it into the DOM, manages associated CSS and JS assets, and provides fallbacks and error handling for robustness.", "external_files": ["/assets/common.css", "/assets/spotify-1-0-3.css", "/assets/app.js", "/assets/spotify-1-0-3.js", "/assets/spotify-1-0-3.html"], "external_methods": ["globalThis.fetch"], "published": ["htmlContent", "showError"], "classes": [{"name": "FigmaScreenComponent", "description": "An Angular standalone component that loads and safely injects external Figma preview HTML, handling assets and fallback UI."}], "methods": [{"name": "ngOnInit", "description": "Initializes component, injects assets, fetches HTML, sanitizes, and handles errors."}, {"name": "ngOnDestroy", "description": "Cleans up dynamically added DOM nodes on component destruction."}, {"name": "appendStylesheet", "description": "Dynamically injects a stylesheet link if not already present."}, {"name": "appendScript", "description": "Dynamically injects a script tag for external JS assets, avoids duplicates."}, {"name": "extractBodyInnerHtml", "description": "Extracts inner HTML from a full HTML document and strips script tags for safety."}, {"name": "rewriteAssetUrls", "description": "Rewrites relative URLs within the HTML to absolute asset paths and removes redundant tags."}, {"name": "fetchDesignHtmlWithValidation", "description": "Fetches the external HTML, validates, and rewrites URLs. Throws on failure."}, {"name": "setInlineFallbackHtml", "description": "Provides a safe default HTML fallback if fetching or rendering fails."}], "calls": ["fetch", "appendStylesheet", "appendScript", "extractBodyInnerHtml", "rewriteAssetUrls"], "search-terms": ["FigmaScreenComponent", "HTML fetch", "asset URL rewriting", "Angular safe HTML injection", "fallback UI", "external asset injection", "standalone Angular component"], "state": 2, "file_id": 21, "knowledge_revision": 70, "git_revision": "157fde7c8bedd3fa7f552e8711f6457899011078", "revision_history": [{"43": ""}, {"47": ""}, {"48": ""}, {"49": ""}, {"51": "d996abcea0f056656a880b277976ad2dab0099d9"}, {"52": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"53": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"56": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"58": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"60": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"61": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"62": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"63": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"64": "4b9dc0675dd9a7ae5545a20a373cceabb6fc7151"}, {"70": "157fde7c8bedd3fa7f552e8711f6457899011078"}], "ctags": [{"_type": "tag", "name": "FigmaScreenComponent", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^export class FigmaScreenComponent implements OnInit, OnDestroy {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const body = this.doc.body || this.doc.getElementsByTagName('body')?.[0];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "bodyMatch", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const bodyMatch = html.match(\\/<body[^>]*>([\\\\s\\\\S]*?)<\\\\\\/body>\\/i);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let content = html;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "css1", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const css1 = this.appendStylesheet('\\/assets\\/common.css') || this.appendStylesheet('assets\\//", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "css2", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const css2 = this.appendStylesheet('\\/assets\\/spotify-1-0-3.css') || this.appendStylesheet('/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "doc", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^  private readonly doc = inject(DOCUMENT);$/", "language": "TypeScript", "kind": "property", "scope": "FigmaScreenComponent", "scopeKind": "class"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const existing = head.querySelector(`link[rel=\"stylesheet\"][href=\"${href}\"]`);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const existing = this.doc.querySelector(`script[src=\"${src}\"]`);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fallback", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const fallback = `$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "g", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const g: any = (typeof globalThis !== 'undefined') ? globalThis : undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "head", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const head = this.doc.head || this.doc.getElementsByTagName('head')?.[0];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const html = await this.fetchDesignHtmlWithValidation('\\/assets\\/spotify-1-0-3.html').catc/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let html = await resp.text();$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "js1", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const js1 = this.appendScript('\\/assets\\/app.js', false) || this.appendScript('assets\\/app/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "js2", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const js2 = this.appendScript('\\/assets\\/spotify-1-0-3.js', false) || this.appendScript('a/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "link", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const link = this.doc.createElement('link');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "node", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    for (const node of this.addedNodes) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "out", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let out = html;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const resp = await (globalThis as any).fetch(url, { credentials: 'same-origin' }).catch((err/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "script", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const script = this.doc.createElement('script');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const status = resp ? `${resp.status} ${resp.statusText || ''}`.trim() : 'no-response';$/", "language": "TypeScript", "kind": "constant"}], "hash": "78fd907fcf778e319934c32d15561042", "format-version": 4, "code-base-name": "web_frontend", "filename": "web_frontend/src/app/figma-screen/figma-screen.component.ts", "fields": [{"name": "let content = html;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private readonly doc = inject(DOCUMENT);", "scope": "FigmaScreenComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "let html = await resp.text();", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let out = html;", "scope": "", "scopeKind": "", "description": "unavailable"}]}