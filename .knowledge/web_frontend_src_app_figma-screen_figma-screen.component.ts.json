{"is_source_file": true, "format": "TypeScript (Angular component)", "description": "This file defines the FigmaScreenComponent in Angular that renders embedded Figma design HTML dynamically by fetching content, sanitizing it, and managing script/style dependencies. It includes logic for fallback UI and injects external assets securely.", "external_files": ["assets/common.css", "assets/spotify-1-0-3.css", "assets/spotify-1-0-3.html", "assets/app.js", "assets/spotify-1-0-3.js"], "external_methods": ["fetch", "console.error"], "published": ["FigmaScreenComponent"], "classes": [{"name": "FigmaScreenComponent", "description": "Angular component responsible for injecting and rendering external Figma design HTML, managing dependencies, and providing fallback UI."}], "methods": [{"name": "ngOnInit", "description": "Initializes the component, injects styles, fetches HTML, sanitizes, and injects scripts."}, {"name": "ngOnDestroy", "description": "Cleans up dynamically injected nodes to prevent duplicates."}, {"name": "appendStylesheet", "description": "Dynamically appends a stylesheet link to the document head if not already present."}, {"name": "appendScript", "description": "Dynamically appends a script element to the document body if not already present."}, {"name": "extractBodyInnerHtml", "description": "Extracts inner HTML from the body tag of a full HTML document string and strips script tags for safety."}, {"name": "rewriteAssetUrls", "description": "Rewrites relative URLs in the HTML to absolute /assets/... paths and removes inline stylesheet/script tags."}, {"name": "fetchDesignHtmlWithValidation", "description": "Fetches the external HTML, validates response, extracts and rewrites URL paths for injection."}, {"name": "setInlineFallbackHtml", "description": "Sets a minimal fallback HTML content to avoid blank screens on errors."}], "calls": ["this.appendStylesheet", "this.appendScript", "this.fetchDesignHtmlWithValidation", "this.sanitizer.bypassSecurityTrustHtml", "console.error", "this.extractBodyInnerHtml", "this.rewriteAssetUrls"], "search-terms": ["FigmaScreenComponent", "angular component HTML injection", "external design HTML fetch", "asset URL rewriting", "fallback UI", "script and stylesheet injection", "HTML sanitization"], "state": 2, "file_id": 21, "knowledge_revision": 64, "git_revision": "4b9dc0675dd9a7ae5545a20a373cceabb6fc7151", "revision_history": [{"43": ""}, {"47": ""}, {"48": ""}, {"49": ""}, {"51": "d996abcea0f056656a880b277976ad2dab0099d9"}, {"52": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"53": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"56": "1515c59f6e8aca661e2b8caf1217a040b9a257f8"}, {"58": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"60": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"61": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"62": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"63": "822b45b52dc34497448ac96ad8dd8f5623c6aa6a"}, {"64": "4b9dc0675dd9a7ae5545a20a373cceabb6fc7151"}], "ctags": [{"_type": "tag", "name": "FigmaScreenComponent", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^export class FigmaScreenComponent implements OnInit, OnDestroy {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "body", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const body = this.doc.body || this.doc.getElementsByTagName('body')?.[0];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "bodyMatch", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const bodyMatch = html.match(\\/<body[^>]*>([\\\\s\\\\S]*?)<\\\\\\/body>\\/i);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "content", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let content = html;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "css1", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const css1 = this.appendStylesheet('\\/assets\\/common.css') || this.appendStylesheet('assets\\//", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "css2", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const css2 = this.appendStylesheet('\\/assets\\/spotify-1-0-3.css') || this.appendStylesheet('/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "doc", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^  private readonly doc = inject(DOCUMENT);$/", "language": "TypeScript", "kind": "property", "scope": "FigmaScreenComponent", "scopeKind": "class"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const existing = head.querySelector(`link[rel=\"stylesheet\"][href=\"${href}\"]`);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const existing = this.doc.querySelector(`script[src=\"${src}\"]`);$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "fallback", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const fallback = `$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "g", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const g: any = (typeof globalThis !== 'undefined') ? globalThis : undefined;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "head", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const head = this.doc.head || this.doc.getElementsByTagName('head')?.[0];$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const html = await this.fetchDesignHtmlWithValidation('assets\\/spotify-1-0-3.html');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let html = await resp.text();$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "js1", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const js1 = this.appendScript('\\/assets\\/app.js', false) || this.appendScript('assets\\/app/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "js2", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const js2 = this.appendScript('\\/assets\\/spotify-1-0-3.js', false) || this.appendScript('a/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "link", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const link = this.doc.createElement('link');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "node", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    for (const node of this.addedNodes) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "out", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    let out = html;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "resp", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^    const resp = await (globalThis as any).fetch(url, { credentials: 'same-origin' }).catch((err/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "script", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const script = this.doc.createElement('script');$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "status", "path": "/home/kavia/workspace/code-generation/music-streamer-190098-190111/web_frontend/src/app/figma-screen/figma-screen.component.ts", "pattern": "/^      const status = resp ? `${resp.status} ${resp.statusText || ''}`.trim() : 'no-response';$/", "language": "TypeScript", "kind": "constant"}], "hash": "d85fa49bd2fd988bbdbb30dfbf8213ff", "format-version": 4, "code-base-name": "web_frontend", "filename": "web_frontend/src/app/figma-screen/figma-screen.component.ts", "fields": [{"name": "let content = html;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private readonly doc = inject(DOCUMENT);", "scope": "FigmaScreenComponent", "scopeKind": "class", "description": "unavailable"}, {"name": "let html = await resp.text();", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "let out = html;", "scope": "", "scopeKind": "", "description": "unavailable"}]}